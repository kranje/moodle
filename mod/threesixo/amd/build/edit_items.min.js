define("mod_threesixo/edit_items",["exports","jquery","core/templates","core/notification","core/ajax","mod_threesixo/question_bank","mod_threesixo/events","core/toast","core/str","core/pending"],(function(_exports,_jquery,Templates,Notification,_ajax,Bank,_events,_toast,_str,_pending){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),Templates=_interopRequireWildcard(Templates),Notification=_interopRequireWildcard(Notification),_ajax=_interopRequireDefault(_ajax),Bank=_interopRequireWildcard(Bank),_pending=_interopRequireDefault(_pending);const ACTIONS_DELETE='[data-action="delete-item"]',ACTIONS_MOVE_UP='[data-action="move-item-up"]',ACTIONS_MOVE_DOWN='[data-action="move-item-down"]',ACTIONS_PICK_QUESTION="#btn-question-bank";return _exports.default=class{constructor(threesixtyid){var obj,key,value;value=void 0,(key="threesixtyId")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.threesixtyId=threesixtyid,this.registerEvents()}refreshItemList(){const pending=new _pending.default("mod_threesixo/refreshItems"),editItems=this;_ajax.default.call([{methodname:"mod_threesixo_get_items",args:{threesixtyid:editItems.threesixtyId}}])[0].then((function(response){const context={threesixtyid:editItems.threesixtyId},items=[],itemCount=response.items.length;return response.items.forEach((value=>{const item=value;item.deletebutton=!0,item.moveupbutton=!1,item.movedownbutton=!1,item.type=value.typetext,itemCount>1&&(1===value.position?item.movedownbutton=!0:value.position===itemCount?item.moveupbutton=!0:value.position>1&&value.position<itemCount&&(item.moveupbutton=!0,item.movedownbutton=!0)),items.push(item)})),context.allitems=items,Templates.render("mod_threesixo/list_360_items",context)})).then((compiledSource=>(document.querySelector('[data-region="itemlist"]').outerHTML=compiledSource,pending.resolve()))).catch(Notification.exception)}callItemAction(action,itemId,successMessage){const threesixtyId=this.threesixtyId;_ajax.default.call([{methodname:action,args:{itemid:itemId}}])[0].then((response=>{if(response.result)return successMessage;const warnings=response.warnings.join((0,_jquery.default)("<br/>"));throw new Error(warnings)})).then((message=>((0,_events.notifyItemsUpdated)(threesixtyId),(0,_toast.add)(message,{})))).catch(Notification.exception)}registerEvents(){const editItems=this;document.addEventListener("click",(e=>{let actionButton="",action="",successMessage="";if(e.target.closest(ACTIONS_DELETE)?(actionButton=e.target.closest(ACTIONS_DELETE),action="mod_threesixo_delete_item",successMessage=(0,_str.get_string)("itemdeleted","mod_threesixo")):e.target.closest(ACTIONS_MOVE_UP)?(actionButton=e.target.closest(ACTIONS_MOVE_UP),action="mod_threesixo_move_item_up",successMessage=(0,_str.get_string)("itemmovedup","mod_threesixo")):e.target.closest(ACTIONS_MOVE_DOWN)?(actionButton=e.target.closest(ACTIONS_MOVE_DOWN),action="mod_threesixo_move_item_down",successMessage=(0,_str.get_string)("itemmoveddown","mod_threesixo")):e.target.closest(ACTIONS_PICK_QUESTION)&&(e.preventDefault(),Bank.init(editItems.threesixtyId)),action){e.preventDefault();const tooltipId=actionButton.getAttribute("aria-describedby");if(tooltipId){const tooltip=document.querySelector("#".concat(tooltipId));tooltip&&tooltip.remove()}const itemId=actionButton.dataset.itemid;editItems.callItemAction(action,itemId,successMessage)}})),document.addEventListener(_events.eventTypes.itemsUpdated,(function(){editItems.refreshItemList()}))}},_exports.default}));

//# sourceMappingURL=edit_items.min.js.map