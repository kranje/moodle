/**
 * AMD code for the frequently used comments chooser for the marking guide grading form.
 *
 * @module     mod_threesixo/view
 * @class      view
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_threesixo/view",["jquery","core/templates","core/notification","core/ajax","core/str","core/modal_factory","core/modal_events"],(function($,Templates,notification,ajax,Str,ModalFactory,ModalEvents){var threesixtyid,ACTIONS_DECLINE_FEEDBACK='[data-action="decline-feedback"]',ACTIONS_UNDO_DECLINE='[data-action="undo-decline"]';function refreshParticipantsList(){var promises=ajax.call([{methodname:"mod_threesixo_data_for_participant_list",args:{threesixtyid:threesixtyid}}]);$.when(promises[0]).then((function(response){return Templates.render("mod_threesixo/list_participants",response)})).done((function(compiledSource,js){$('[data-region="participantlist"]').replaceWith(compiledSource),Templates.runTemplateJS(js)})).fail(notification.exception)}var view=function(id){threesixtyid=id,this.registerEvents()};return view.prototype.registerEvents=function(){$(ACTIONS_DECLINE_FEEDBACK).click((function(e){e.preventDefault();var context={statusid:$(this).data("statusid"),name:$(this).data("name")},declineTemplatePromise=Templates.render("mod_threesixo/decline_feedback",context),titlePromise=Str.get_string("declinefeedback","mod_threesixo");$.when(titlePromise).then((function(title){return ModalFactory.create({title:title,body:declineTemplatePromise,large:!0,type:ModalFactory.types.SAVE_CANCEL})})).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.save,(function(){var data={statusid:$("#decline-statusid").val(),declinereason:$("#decline-reason").val().trim()};ajax.call([{methodname:"mod_threesixo_decline_feedback",args:data}])[0].done((function(){refreshParticipantsList()})).fail(notification.exception)}))})).fail(notification.exception)})),$(ACTIONS_UNDO_DECLINE).click((function(e){e.preventDefault();var data={statusid:$(this).data("statusid")};ajax.call([{methodname:"mod_threesixo_undo_decline",args:data}])[0].done((function(){refreshParticipantsList()})).fail(notification.exception)}))},view}));

//# sourceMappingURL=view.min.js.map