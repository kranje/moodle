{"version":3,"sources":["../src/submissionhelper.js"],"names":["define","$","log","str","debug","uploadstate","togglestate","strings","init","opts","component","filecontrolid","togglingthing","safesave","register_controls","register_events","toggle_currentsubmission","that","controls","formsubmitbutton","deletebutton","updatecontrol","currentcontainer","reccontainer","togglecontainer","togglebutton","toggletext","prassigsub","evt","filename","prassigsubUploaded","CustomEvent","details","document","dispatchEvent","removeAttr","upc","length","window","parent","get","value","trigger","attr","get_string","done","s","click","confirm","M","util","val","html","toggle_recorder","do_toggle","removeClass","addClass","text","toggle","duration","complete"],"mappings":"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","sourcesContent":["define(['jquery','core/log','core/str'], function($,log,str) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('submission helper: initialising');\n\n    return {\n\n        uploadstate: false,\n        togglestate: 0,\n        strings: {},\n\n\n        init:  function(opts) {\n\n            this.component = opts['component'];\n            this.filecontrolid = opts['filecontrolid'];\n            this.togglingthing = opts['togglingthing'];\n            this.safesave=opts['safesave'];\n            this.register_controls();\n            this.register_events();\n\n\n            //we might want to expand current submission by default.\n            if(this.togglingthing=='currentsubmission') {\n                if (opts['expandcurrentsubmission']) {\n                    this.toggle_currentsubmission(this);\n                }\n            }\n        },\n\n        register_controls: function(){\n          var that=this;\n          this.controls={};\n          this.controls.formsubmitbutton = $('#id_submitbutton');\n          this.controls.deletebutton = $('.' + this.component + '_deletesubmissionbutton');\n          this.controls.updatecontrol =  $('#' + this.filecontrolid);\n          this.controls.currentcontainer =  $('.' + this.component + '_currentsubmission');\n          this.controls.reccontainer =  $('.' + this.component + '_recorder');\n          this.controls.togglecontainer =  $('.' + this.component + '_togglecontainer');\n          this.controls.togglebutton =  $('.' + this.component + '_togglecontainer .togglebutton');\n          this.controls.toggletext =  $('.' + this.component + '_togglecontainer .toggletext');\n\n            var that = this;\n            var prassigsub = function (evt) {\n                if(evt){\n                    switch(evt[1]) {\n                        case 'filesubmitted':\n                            var filename = evt[2];\n                            var updatecontrol = evt[3];\n                            // post a custom event that a filter template might be interested in\n                            var prassigsubUploaded = new CustomEvent(\"prassigsubUploaded\", {details: evt});\n                            document.dispatchEvent(prassigsubUploaded);\n\n                            //if opts safe save\n                            if(that.safesave==1) {\n                                that.controls.formsubmitbutton.removeAttr('disabled');\n                            }\n\n                            //poke the filename\n                            var upc = '';\n                            if (typeof updatecontrol !== 'undefined' && updatecontrol !== '') {\n                                upc = $('[id=\"' + updatecontrol + '\"]');\n                            }\n                            if (upc.length < 1) {\n                                upc = $('[id=\"' + updatecontrol + '\"]', window.parent.document);\n                            }\n                            if (upc.length > 0) {\n                                upc.get(0).value = filename;\n                            } else {\n                                log.debug('upload failed #2');\n                                return false;\n                            }\n                            upc.trigger('change');\n                            break;\n                        case 'started':\n                            //if opts safe save\n                            if(that.safesave==1) {\n                                that.controls.formsubmitbutton.attr('disabled', 'disabled');;\n                            }\n\n                            break;\n                    }\n                }\n            }; //end of callback function\n            window.prassigsub = prassigsub;\n\n\n\n            str.get_string('clicktohide',that.component).done(function(s) {\n                that.strings['clicktohide']=s;\n            });\n            str.get_string('clicktoshow',that.component).done(function(s) {\n                that.strings['clicktoshow']=s;\n            });\n        },\n\n        register_events: function(){\n            var that =this;\n            this.controls.deletebutton.click(function(){\n                if(that.controls.updatecontrol){\n                    if(confirm(M.util.get_string('reallydeletesubmission',that.component))){\n                        that.controls.updatecontrol.val(-1);\n                        that.controls.currentcontainer.html('');\n                    }\n                }\n            });\n\n            //we only toggle(hide/show) currentsubmission OR recorder, not both\n            if(this.togglingthing==='currentsubmission') {\n                this.controls.togglebutton.click(function () {\n                    that.toggle_currentsubmission(that);\n                });\n                this.controls.toggletext.click(function () {\n                    that.toggle_currentsubmission(that);\n                });\n            }else if(this.togglingthing==='recorder') {\n                this.controls.togglebutton.click(function () {\n                    that.toggle_recorder(that);\n                });\n                this.controls.toggletext.click(function () {\n                    that.toggle_recorder(that);\n                });\n            }\n        },\n\n        do_toggle: function(that){\n            if(that.togglestate===0){\n                that.controls.togglebutton.removeClass('fa-toggle-off');\n                that.controls.togglebutton.addClass('fa-toggle-on');\n                that.controls.toggletext.text(that.strings['clicktohide']);\n                that.togglestate=1;\n            }else{\n                that.controls.togglebutton.removeClass('fa-toggle-on');\n                that.controls.togglebutton.addClass('fa-toggle-off');\n                that.controls.toggletext.text(that.strings['clicktoshow']);\n                that.togglestate=0;\n            }\n        },\n\n        toggle_currentsubmission: function(that){\n            that.controls.currentcontainer.toggle(\n                {duration: 300, complete: function(){that.do_toggle(that);}}\n            );\n            return false;\n        },\n\n        toggle_recorder: function(that){\n            that.controls.reccontainer.toggle(\n                {duration: 300, complete: function(){that.do_toggle(that);}}\n            );\n            return false;\n        }\n    };//end of return object\n});"],"file":"submissionhelper.min.js"}